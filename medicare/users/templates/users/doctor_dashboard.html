{% extends "base.html" %}
{% load static %}

{% block title %}Doctor Dashboard - MediCare{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/doctor_dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">

    <div class="page-header-with-back">
        <a href="{% url 'home' %}" class="back-button">Home</a>
        <h1>ğŸ‘¨â€âš•ï¸ Doctor Dashboard</h1>
    </div>

    <header class="top-header">
        <p class="welcome-text">
            Welcome, Dr. {{ request.user.username }}  
            <span class="small">({{ request.user.get_specialty_display }})</span>
        </p>

        <div class="quick-actions">
            <a href="{% url 'create_prescription' %}" class="quick-action-btn">
                <i class="fas fa-plus"></i>
                <span>Create Prescription</span>
            </a>
            <a href="{% url 'doctor_adherence' %}" class="quick-action-btn">
                <i class="fas fa-chart-bar"></i>
                <span>View Adherence</span>
            </a>
        </div>
    </header>

    <!-- PATIENTS -->
    <section class="card">
        <h2 class="card-title">ğŸ‘¥ Your Patients</h2>
        <ul class="list">
            {% for patient in patients %}
                <li class="list-item">
                    <span class="name">{{ patient.username }}</span>
                    <span class="condition">{{ patient.disease.name|default:"No disease assigned" }}</span>
                </li>
            {% empty %}
                <li class="empty">No patients yet.</li>
            {% endfor %}
        </ul>
    </section>

    <!-- Rare disease patients -->
    <section class="card">
        <h2 class="card-title">ğŸ¦  Rare Disease Patients</h2>
        <ul class="list">
            {% for p in rare_patients %}
                <li class="list-item">
                    <span class="name">{{ p.username }}</span>
                    <span class="drug">
                        â€” {{ p.disease.name }} {% if p.disease.is_rare %}<span class="badge">Rare</span>{% endif %}
                    </span>
                </li>
            {% empty %}
                <li class="empty">No rare disease patients yet.</li>
            {% endfor %}
        </ul>
    </section>    

    <!-- PRESCRIPTIONS -->
    <section class="card">
        <h2 class="card-title">ğŸ’Š Prescriptions</h2>
        <ul class="list">
            {% for p in prescriptions %}
                <li class="list-item">
                    <span class="name">{{ p.patient.username }}</span>
                    <span class="drug">â€” {{ p.drug.name }} ({{ p.dosage }}, {{ p.frequency }})</span>

                    <div class="actions">
                        <a href="{% url 'create_reminder' p.id %}" class="btn small">â° Reminder</a>
                        <a href="{% url 'edit_prescription' p.id %}" class="btn small edit">âœï¸ Edit</a>
                        <a href="{% url 'delete_prescription' p.id %}" class="btn small delete">ğŸ—‘ï¸ Delete</a>
                    </div>
                </li>

            {% empty %}
                <li class="empty">No prescriptions yet.</li>
            {% endfor %}
        </ul>
    </section>

    <!-- REMINDERS -->
    <section class="card">
        <h2 class="card-title">â° Reminders</h2>
        <ul class="list">
            {% for r in reminders %}
                <li class="list-item">
                    <span class="name">{{ r.patient.username }}</span>
                    <span class="drug">â€” {{ r.prescription.drug.name }} at {{ r.time }}</span>

                    <div class="actions">
                        <a href="{% url 'email_reminder' r.id %}" class="btn small">ğŸ“§ Email patient</a>
                    </div>
                </li>
            {% empty %}
                <li class="empty">No reminders yet.</li>
            {% endfor %}
        </ul>
    </section>

</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/doctor_dashboard.js' %}"></script>
{% endblock %}
